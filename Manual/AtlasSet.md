# AtlasSet について

## このコンポーネントの概要

このコンポーネントは、複数のテクスチャー必要な部分だけまとめた一枚のテクスチャーにすることができて、いろいろなところから衣装を引っ張ってきて、テクスチャーの使用していない部分が多い時に必要な部分だけをまとめて、見た目に大きな影響を出さずに、VRAM 容量(とアバターのサイズ)を削減することを目的としたコンポーネントです。

## 使い方

### 始めに

TexTransTool/Runtime/TexturAtlas にある AtlasSet.cs から、
またはインスペクターのコンポーネントを追加の TexTransTool/AtlasSet から
ゲームオブジェクトに追加できます。

### アトラス化の仕方

- アトラス化したい対象の親を TargetRoot に追加し
- アトラス化したいテクスチャーを持つマテリアルのリストにチェックを入れて
- Compile ボタンをすとアトラス化しされたテクスチャを生成

Apply ボタンを押すとそのアトラス化されたテクスチャをプレビューすることができます。

### アトラス化する対象について

TargetRoot に追加したゲームオブジェクトの子にあるすべての SkindMeshRenderer と MeshRenderer の IsTarget のチェックが入ったマテリアルが対象となり、アトラス化されます。

## プロパティ

### TargetRoot

レンダラーの親のオブジェクトをセットするプロパティ。

### MaterialSelector And Offset

IsTarget の下にあるチェックボックスがアトラス化するかどうかの選択で

それにチェックが入っている場合 Float のプロパティが表示されその値がOffSetとなり、

アトラス化するときのテクスチャーの比率となり、それら比率の調整は手動でもできますが、上に表示されている「Automatic OffSet Setting」を実行すれば、それらのテクスチャーの解像度に基づいた比率になります。

そして、存在しないはずのマテリアルが表示されている場合や、存在するはずのマテリアルがない場合は「ReserchRenders」を実行しましょう。

### ForsedMaterialMarge

チェックを入れると、強制的にマテリアルを一つに統合することができます。

マテリアル数の削減はできるためSetPassCallなどの削減になりますが、マテリアルスロット数の削減はできないのでご注意ください。
スロット数を削減したい場合は[AvatarOptimaizer](https://github.com/anatawa12/AvatarOptimizer)との併用をお勧めします。

見た目への影響が大きいので使用の際はご注意ください。
この機能を使う際は下記のUseRefarensMaterialとの併用をお勧めします。

#### UseRefarensMaterial

チェックを入れると、マテリアルをセットできるプロパティが表示され、そこにセットしたマテリアルに、アトラス化されたテクスチャーがセットされ、適応されます。

これのチェックが入っていない場合、最初のマテリアルが使用され、そのマテリアルにアトラス化されたテクスチャーがセットされ、適応されます。

#### ForseSetTexture

チェックを入れると、マテリアルに対してアトラス化されたテクスチャーをすべて強制的にセットします。

チェックが入っていないときは、マテリアルのプロパティーにすでにテクスチャーが入っている場合そのプロパティーはアトラス化されたテクスチャーがセットされます。

### AtlasTextureSize

アトラス化したテクスチャの解像度で X が横 Y 縦になります。

### Pading

アトラス化したテクスチャの UV の外側にどれくらいテクスチャを広げるかの数値です。
MipMap が使用されるとき境目の色がにじんでしまう問題があった場合大きめにしましょう。

### PadingType

Pading の計算方法を指定します。

EdgeBase - 一番近い辺のポイントからの距離
VartexBase - 一番近い頂点からの距離 (非推奨)

### SortingType

アトラス化するときの自動生成 UV の並べ方を指定します。

EvenlySpaced - 適当な順番でマス目にしたがって並べます。(非推奨)
NextFitDecreasingHeight - 高さ順に左下から敷き詰めます。(非推奨)
NextFitDecreasingHeightPlusFloorCeilineg - 高さ順に左下から敷き詰め、左下からはいらなくなったら右上から入るものをできるだけ詰めます。

もっと効率的なUVの並び替えアルゴリズムを知ってる（実装できる）方ははIsuuseを立てるかPullRequestを投げてくれると助かります。

### UseIslandCash

メッシュのUVとトライアングルからUVのまとまり（アイランド）を計算するとき、キャッシュを使うかどうかのプロパティで、
基本的に、オンを推奨しますが、キャッシュを使用することで問題がある場合はオフにしてください。

キャッシュを使わないのではなく削除したい場合は、Assets/TexTransToolGenareats にある「IslandCash_~~~」と名前のついているオブジェクトを削除してください。

### Contenar

アトラス化、コンパイルしたデータの参照です。

### PostProsess

コンパイルしたテクスチャに解像度を指定する、などの設定を指定する配列。

#### SetTextureMaxSize

テクスチャーの設定にある最大サイズを変更します。

#### SetNormalMapSetting

テクスチャーの設定にあるテクスチャタイプを法線マップにします。

#### PostProsess の細かい設定

##### Select

- NonPropatys そのプロパティ以外を対象にそれを実行します。
- Propatys そのプロパティを対象にそれを実行します。

##### TargetPropatyName(s)

プロパティの選択で、このプロパティというのは、Material のデバッグインスペクターでなどで見れる文字列で、シェーダーなどのプロパティと同一のものを指します。
